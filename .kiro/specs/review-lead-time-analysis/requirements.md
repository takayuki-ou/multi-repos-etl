# 要件定義書

## 概要

レビューリードタイム分析機能は、Pull Requestが開かれてから閉じられるまでの経過時間を分析し、開発チームのレビュープロセスの効率性を可視化する機能です。この機能により、チームはレビューのボトルネックを特定し、開発プロセスの改善点を見つけることができます。

## 要件

### 要件1

**ユーザーストーリー:** 開発チームリーダーとして、プルリクエストのレビューリードタイムを分析したい。これにより、レビュープロセスのボトルネックを特定し、チーム効率を向上させることができる。

#### 受入基準

1. ユーザーがレビューリードタイム分析を要求した時、システムは各プルリクエストについてPR作成から終了までの時間差を計算すること
2. リードタイムを計算する時、システムはマージされたプルリクエストと（マージされずに）クローズされたプルリクエストの両方を処理すること
3. 結果を表示する時、システムはリードタイムを人間が読みやすい形式（日、時間、分）で表示すること
4. プルリクエストが存在しない時、システムはデータが利用できないことを示す適切なメッセージを表示すること

### 要件2

**ユーザーストーリー:** プロジェクトマネージャーとして、レビューリードタイムの統計サマリーを表示したい。これにより、チーム全体のパフォーマンスとトレンドを理解することができる。

#### 受入基準

1. 統計を生成する時、システムは平均、中央値、最小値、最大値のリードタイムを計算すること
2. 統計を表示する時、システムはパーセンタイル分布（25パーセンタイル、75パーセンタイル、90パーセンタイル）を表示すること
3. 統計を計算する時、システムは平均から標準偏差の3倍を超える外れ値を除外すること
4. プルリクエストが3件未満の場合、システムは基本統計のみ（件数、平均）を表示すること

### 要件3

**ユーザーストーリー:** 開発者として、リポジトリ、期間、作成者でレビューリードタイム分析をフィルタリングしたい。これにより、レビュープロセスの特定の側面に焦点を当てることができる。

#### 受入基準

1. リポジトリでフィルタリングする時、システムは選択されたリポジトリからのプルリクエストのみを表示すること
2. 日付範囲でフィルタリングする時、システムは指定された期間内に作成されたプルリクエストのみを含めること
3. 作成者でフィルタリングする時、システムは指定されたユーザーが作成したプルリクエストのみを表示すること
4. 複数のフィルターが適用される時、システムはANDロジックを使用してすべてのフィルターを適用すること
5. フィルターに一致するデータがない時、システムは一致するプルリクエストが見つからないことを示すメッセージを表示すること

### 要件4

**ユーザーストーリー:** チームメンバーとして、時系列でのレビューリードタイムトレンドを可視化したい。これにより、レビュープロセスが改善されているか悪化しているかを確認することができる。

#### 受入基準

1. トレンド可視化を生成する時、システムはプルリクエストを時間期間（週次または月次）でグループ化すること
2. トレンドを表示する時、システムは各時間期間の平均リードタイムを表示すること
3. 複数のリポジトリがある時、システムはリポジトリごとまたは統合されたトレンドの表示を可能にすること
4. 時間期間にプルリクエストがない場合、システムは可視化でその期間をゼロで表示するかスキップすること

### 要件5

**ユーザーストーリー:** 品質保証エンジニアとして、レビューリードタイムデータをエクスポートしたい。これにより、追加の分析を実行したり、ステークホルダー向けのレポートを作成することができる。

#### 受入基準

1. データをエクスポートする時、システムはCSV形式でデータを提供すること
2. エクスポートする時、システムはPRタイトル、リポジトリ、作成者、作成日、終了日、計算されたリードタイムを含めること
3. フィルターを適用する時、システムはフィルターされたデータのみをエクスポートすること
4. エクスポートが要求された時、システムはファイルを生成し、ダウンロード機能を提供すること