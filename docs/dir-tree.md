## **GitHub PRログ分析システム ディレクトリ構成案**

メンテナンス性を高めるため、システムを構成する各要素（データ取得、DB操作、分析ロジック、設定、実行スクリプトなど）を論理的にグループ化し、ディレクトリとして分離します。

github-pr-da/  
├── .env                    \# 環境変数ファイル (GitHub PATなど機密情報)  
├── .gitignore              \# Git管理から除外するファイル/ディレクトリ指定 (venv/, .env, output/など)  
├── README.md               \# プロジェクト概要、セットアップ、実行方法などの説明  
├── requirements.txt        \# プロジェクトが依存するPythonライブラリリスト  
├── venv/                   \# Python仮想環境ディレクトリ (gitignore対象)  
├── src/                    \# システムの主要なソースコード  
│   ├── \_\_init\_\_.py         \# srcディレクトリをPythonパッケージとして認識させる  
│   ├── config/             \# 設定関連モジュール  
│   │   ├── \_\_init\_\_.py  
│   │   └── settings.py     \# 設定ファイルの読み込み、設定値へのアクセスを管理  
│   │   └── config.yaml     \# 対象リポジトリリストなどのシステム設定ファイル  
│   ├── db/                 \# データベース操作関連モジュール  
│   │   ├── \_\_init\_\_.py  
│   │   ├── database.py     \# DB接続、セッション管理など共通DB処理  
│   │   ├── schema.sql      \# PostgreSQLのテーブル作成SQL定義  
│   │   └── models.py       \# ORM (SQLAlchemyなど) を使用する場合のモデル定義  
│   │   └── migrations/     \# DBスキーマ変更管理ファイル (Alembicなどを使用する場合)  
│   ├── github\_api/         \# GitHub API連携モジュール  
│   │   ├── \_\_init\_\_.py  
│   │   └── client.py       \# GitHub APIクライアントクラス (認証、リクエスト、ページネーション処理)  
│   │   └── fetcher.py      \# PR、コメント、レビューコメントなどのデータ取得ロジック  
│   ├── data\_processing/    \# 取得データの整形・DB投入モジュール  
│   │   ├── \_\_init\_\_.py  
│   │   └── processor.py    \# API応答データのパース、整形、DBへのUPSERT処理  
│   ├── analysis/           \# 分析ロジックモジュール  
│   │   ├── \_\_init\_\_.py  
│   │   └── metrics.py      \# 各種メトリクス（頻度、文字数、リードタイム）の計算ロジック  
│   │   └── analyzer.py     \# DBからデータを取得し、metricsモジュールを使って分析を実行  
│   ├── report/             \# レポート・可視化モジュール  
│   │   ├── \_\_init\_\_.py  
│   │   └── generator.py    \# テキスト/CSVレポート生成ロジック  
│   │   └── visualizer.py   \# グラフ生成ロジック (matplotlib/seaborn使用)  
│   └── utils/              \# 共通ユーティリティモジュール  
│       ├── \_\_init\_\_.py  
│       └── time\_utils.py   \# 日時計算やフォーマット関連ユーティリティ  
│       └── db\_utils.py     \# 簡易的なDBユーティリティなど  
├── scripts/                \# 実行用スクリプト (cronなどで直接実行されるもの)  
│   ├── fetch\_github\_data.py \# データ取得処理を実行するスクリプト  
│   ├── run\_analysis.py      \# 分析処理を実行するスクリプト  
│   └── generate\_reports.py  \# レポート/可視化処理を実行するスクリプト  
├── sql/                    \# 生SQLクエリファイル (必要に応じて)  
│   └── analysis\_queries.sql \# 分析用の複雑なSQLクエリなど  
└── output/                 \# 生成されたレポートやグラフの出力先ディレクトリ  
    ├── reports/            \# レポートファイル (.csv, .txtなど)  
    └── graphs/             \# グラフ画像ファイル (.png, .jpgなど)

### **構成案の説明**

1. **github\_pr\_analysis/** (プロジェクトルート):  
   * プロジェクト全体の起点となるディレクトリです。  
   * .env: 環境変数（GitHub PAT, DB接続情報など）を定義します。セキュリティのため.gitignoreに追加し、Git管理から除外します。  
   * .gitignore: Gitが追跡しないファイルやディレクトリを指定します（例: venv/, .env, output/）。  
   * README.md: プロジェクトの目的、ディレクトリ構造、セットアップ方法、実行方法、依存ライブラリ、連絡先などを記述し、プロジェクトの理解と運用を助けます。  
   * requirements.txt: プロジェクトが必要とするPythonライブラリとそのバージョンをリストアップします。pip install \-r requirements.txtで依存関係を簡単にインストールできます。  
   * venv/: Pythonの仮想環境を構築するディレクトリです。プロジェクトごとに依存ライブラリを分離し、環境間の干渉を防ぎます。  
2. **src/** (ソースコード):  
   * システムの主要なロジックを実装したPythonコードを配置します。機能や役割ごとにサブディレクトリに分割することで、コードの見通しと保守性を高めます。各サブディレクトリには\_\_init\_\_.pyを置き、Pythonパッケージとして扱えるようにします。  
   * config/: システムの設定（対象リポジトリ、DB接続情報など）を管理します。設定値をコード内に直書きせず、外部ファイルや環境変数から読み込むようにします。  
   * db/: データベース（PostgreSQL）との連携に関するコードを集約します。DB接続、セッション管理、テーブルスキーマ定義（SQLファイルやORM）、データ操作（CRUD）などを担当します。  
   * github\_api/: GitHub REST APIとの通信に特化したコードを配置します。APIクライアントの実装、認証処理、各種エンドポイントへのリクエスト、ページネーション処理などを担います。  
   * data\_processing/: GitHub APIから取得した生のデータを、データベースに投入するために整形・加工するロジックを実装します。データのバリデーションや、既にDBにあるデータとの差分処理（UPSERT）などもここで行います。  
   * analysis/: 分析の中心となるメトリクス計算や集計ロジックを実装します。DBから抽出したデータ（pandas DataFrameなど）に対する処理を行います。  
   * report/: 分析結果を人間が理解しやすい形式（テキスト、CSV、グラフ）に変換するコードを配置します。  
   * utils/: 複数のモジュールから共通して利用される汎用的な関数やクラスを配置します（例: 日時フォーマット、文字列処理、簡易的なファイル操作など）。  
3. **scripts/** (実行用スクリプト):  
   * システムの各主要機能を実行するためのエントリーポイントとなるスクリプトを配置します。これらのスクリプトはsrc/内のモジュールをインポートして使用します。cronなどのスケジューラから直接実行されるのは、主にこのディレクトリ内のスクリプトです。機能をシンプルに呼び出すことに徹し、詳細なロジックはsrc/に委譲します。  
4. **sql/** (生SQLファイル):  
   * 必要に応じて、分析などで使用する複雑なSQLクエリを.sqlファイルとして管理します。これにより、SQLコードとPythonコードを分離できます。  
5. **output/** (出力先ディレクトリ):  
   * システムが生成するレポートファイル（CSV, テキストなど）やグラフ画像などの成果物を保存するディレクトリです。.gitignoreに追加し、生成物をGit管理から除外することが推奨されます。

このディレクトリ構成により、各コンポーネントの責務が明確になり、コードの見通しが良くなります。特定の機能（例: データ取得方法の変更、新しいメトリクスの追加、レポート形式の変更）を修正・追加する際に、影響範囲が限定されやすくなり、結果としてシステムのメンテナンス性が高いレベルで確保されます。また、新しい開発者がプロジェクトに参加した際にも、構造を理解しやすくなります。